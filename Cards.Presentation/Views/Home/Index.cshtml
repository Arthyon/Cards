
<ul id="games">

</ul>
<ul id="gameTypes">
</ul>

<p>Antall spillere i lobbyen: <em id="playerCount"></em></p>
<script>
    $(function() {
        var hub = $.connection.LobbyHub;
        var apiUrl = "/api/LobbyApi/GetAvailableGameTypes";
        hub.client.addGameToList = function(game) {
            var gameList = $("#games");
            var node = $("<li id=\""+game.Id+"\" onclick=\"\">" + game.GameType + ", players: <span class=\"players\">" + game.CurrentPlayers + "</span>/" + game.MaxPlayers + "</li>");
            node.on('click', function() {
                joinGame(game.Id, game.GameType);
            });
            gameList.append(node);

        };

        hub.client.updatePlayerCount = function(gameId, newCount) {
            $("#" + gameId + " .players", "#games").text(newCount);
        };

        hub.client.playersChanged = function(newNumber) {
            $("#playerCount").text(newNumber);
        };


        $.connection.hub.start().done(function() {
            $.getJSON(apiUrl)
                .done(function(data) {
                    // On success, 'data' contains a list of products.
                    $.each(data, function(key, item) {
                        var btn = $("<button>" + item + "</button>");
                        // Add a list item for the product.
                        btn.appendTo($('#gameTypes'));

                        btn.on('click', function() {
                            var gametypeHub = $.connection[item];
                            var game = new PlanningPokerGame();
                            game.MaxPlayers = 5;
                            gametypeHub.server.createGame(game).done(function() {
                                window.location.href = "/Home/Game";
                            }).fail(function() {
                                alert("Fail");
                            });                            
              
                        
                        });
                    });
                });
        });

        function joinGame(id, type) {
            var gametypeHub = $.connection[type];
            gametypeHub.server.joinGame(id)
                .done(function() {
                    window.location.href = "/Home/Game";
                })
                .fail(function() {
                    alert("failed");
                });

        }         
        
         
    });
</script>